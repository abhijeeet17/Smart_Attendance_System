{% extends 'core/base.html' %}

{% block title %}Mark Attendance - Manual{% endblock %}

{% block content %}
<div class="card" style="max-width: 900px; margin: 0 auto;">
    <div class="card-header">
        <h1 class="card-title">
            <i class="fas fa-hand-pointer"></i>
            Mark Attendance - Manual Selection
        </h1>
    </div>
    
    <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(79, 70, 229, 0.1)); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
        <h3 style="font-weight: 600; margin-bottom: 0.5rem;">
            <i class="fas fa-info-circle" style="color: #6366f1;"></i> Session Details
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
            <div>
                <strong>Course:</strong> {{ session.course.course_name }}
            </div>
            <div>
                <strong>Date:</strong> {{ session.session_date|date:"d M, Y" }}
            </div>
            <div>
                <strong>Time:</strong> {{ session.session_time|time:"g:i A" }}
            </div>
            <div>
                <strong>Type:</strong> {{ session.get_session_type_display }}
            </div>
        </div>
    </div>
    
    <form method="post">
        {% csrf_token %}
        
        <div style="background: white; border: 2px solid #e2e8f0; border-radius: 15px; padding: 1.5rem; margin-bottom: 1.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 2px solid #e2e8f0;">
                <h3 style="font-weight: 700; color: #0f172a; margin: 0;">
                    <i class="fas fa-users"></i> Select Present Students
                </h3>
                <div>
                    <button type="button" class="btn btn-outline" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="selectAll()">
                        <i class="fas fa-check-double"></i> Select All
                    </button>
                    <button type="button" class="btn btn-outline" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="deselectAll()">
                        <i class="fas fa-times"></i> Deselect All
                    </button>
                </div>
            </div>
            
            <div style="max-height: 500px; overflow-y: auto;">
                {% for field in form.students %}
                <div style="padding: 1rem; border-bottom: 1px solid #e2e8f0; display: flex; align-items: center; transition: background 0.2s ease; cursor: pointer;" onclick="toggleCheckbox(this)">
                    <div style="flex-shrink: 0; margin-right: 1rem;">
                        {{ field.tag }}
                    </div>
                    <label for="{{ field.id_for_label }}" style="flex: 1; cursor: pointer; margin: 0; font-weight: 500;">
                        {{ field.choice_label }}
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div style="background: rgba(99, 102, 241, 0.05); border-left: 4px solid #6366f1; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
            <h4 style="font-weight: 600; color: #6366f1; margin-bottom: 0.5rem;">
                <i class="fas fa-info-circle"></i> Instructions
            </h4>
            <ul style="color: #64748b; margin-left: 1.5rem; line-height: 1.8;">
                <li>Check the boxes for students who are present</li>
                <li>Unchecked students will be marked as absent</li>
                <li>You can use "Select All" and then uncheck absent students</li>
                <li>Click "Save Attendance" when done</li>
            </ul>
        </div>
        
        <div style="display: flex; gap: 1rem;">
            <button type="submit" class="btn btn-primary" style="flex: 1;">
                <i class="fas fa-save"></i> Save Attendance
            </button>
            <a href="{% url 'mark_attendance' session.id %}" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </form>
</div>

<style>
    .form-check-input {
        width: 20px;
        height: 20px;
        margin-right: 0.5rem;
        cursor: pointer;
    }
    
    input[type="checkbox"]:checked + label {
        color: #10b981;
        font-weight: 600;
    }
</style>

<script>
    function selectAll() {
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = true;
        });
    }
    
    function deselectAll() {
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = false;
        });
    }
    
    function toggleCheckbox(row) {
        const checkbox = row.querySelector('input[type="checkbox"]');
        if (event.target !== checkbox) {
            checkbox.checked = !checkbox.checked;
        }
    }
</script>
{% endblock %}
